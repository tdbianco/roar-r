<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>ANOVA - Analysis of Variance</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Hear me ROAR-R</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Exploring your data
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="propensity-scores.html">Matching Subsamples</a>
    </li>
    <li>
      <a href="geo-info.html">Modelling multi-site data</a>
    </li>
  </ul>
</li>
<li>
  <a href="anova.html">Anova</a>
</li>
<li>
  <a href="lm-assumptions.html">LM</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    LMM
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="lmm-essential-tutorial.html">Essential Tutorial</a>
    </li>
    <li>
      <a href="lmm-contrasts-tutorial.html">Customising Contrasts</a>
    </li>
    <li>
      <a href="lmm-het-var.html">Modelling Heterogeneus Variance</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">ANOVA - Analysis of Variance</h1>

</div>


<p>This is based on my notes of the statistics course given by Prof. Brian Dillon (UMass Amherst).</p>
<div id="anova" class="section level1">
<h1>Anova</h1>
<p>Anova is the analysis of variance based on differences among means of more than two samples, by comparing two estimates of population variance. The first estimate comes from the average of the variance on each group, the within-group or residual variance; the residual variance is determined by chance factors, usually unknown, that influence each observation unpredictably. The second type of variance comes from the variation of means of the samples, the between-group estimate of variance, that varies systematically with our factors of interest, such as treatment or condition.</p>
<div id="t-test-is-a-special-case-of-anova-and-anova-is-a-special-case-of-linear-regression" class="section level2">
<h2>T-test is a special case of Anova, and Anova is a special case of Linear Regression</h2>
<p>When only two groups are compared, the T-test and the Anova hold the same result. Both examine if the population means differ from one another, assuming equal variances for both. The same assumption extends to linear regression, where the residuals (data with group means subtracted) have to be equivalent. In R, the fuction ‘aov’ is actually a wrapper of ‘lm’!</p>
</div>
</div>
<div id="an-example-with-the-variances" class="section level1">
<h1>An example with the Variances</h1>
<p>Let’s create a dummy dataset:</p>
<pre class="r"><code>group &lt;- c(rep(1, 10), rep(2, 10), rep(3, 10)) #idv
response &lt;- round(rnorm(30, mean = 80, sd = 12), digits = 2) #dv
df &lt;- cbind(group, response) #ds
df&lt;-data.frame(df) #various steps to format the ds
names(df)&lt;-c(&quot;treatment&quot;, &quot;score&quot;)
df$treatment&lt;-as.factor(df$treatment)
head(df)</code></pre>
<pre><code>##   treatment score
## 1         1 84.16
## 2         1 92.63
## 3         1 71.88
## 4         1 72.46
## 5         1 67.55
## 6         1 71.89</code></pre>
<p>Let’s calculate the variances</p>
<pre class="r"><code># Root mean squared error for each group
av.sqrt1&lt;-mean(sqrt1&lt;- with(df, sqrt(score[treatment==1])))

av.sqrt2&lt;-mean(sqrt2&lt;- with(df, sqrt(score[treatment==2])))

av.sqrt3&lt;-mean(sqrt3&lt;- with(df, sqrt(score[treatment==3])))

# Group Means
m1&lt;-with(df, mean(score[treatment==1]))
m2&lt;-with(df, mean(score[treatment==2]))
m3&lt;-with(df, mean(score[treatment==3]))

# Grand Mean
GM&lt;-(m1+m2+m3)/3

#Variance Within
Vwith&lt;-(av.sqrt1+av.sqrt2+av.sqrt3)/3

#Variance Between
Vbet&lt;-((m1-GM)^2)+((m2-GM)^2)+((m3-GM)^2)/2

cat(&quot;Within Group Variance:&quot;, round(Vwith, 2), &quot;\n&quot;)</code></pre>
<pre><code>## Within Group Variance: 8.78</code></pre>
<pre class="r"><code>cat(&quot;Between Group Variance:&quot;, round(Vbet, 2))</code></pre>
<pre><code>## Between Group Variance: 55.19</code></pre>
<p>Within the groups, observations vary by a factor of 8.7777676 on average, due to chance factors, such as unsystematic measurement error, idiosynchratic differences between participants and other unknown factors. The average variance between the groups is 55.1882473: the statistical test will investigate if this variance is attributable to treatment - a factor that systematically varies between the groups.</p>
</div>
<div id="running-the-anova" class="section level1">
<h1>Running the ANOVA</h1>
<p>Output of the test:</p>
<pre class="r"><code>aov&lt;-aov(score~treatment, df)
s.aov&lt;-summary(aov) 
s.aov</code></pre>
<pre><code>##             Df Sum Sq Mean Sq F value Pr(&gt;F)
## treatment    2    620   310.0   2.164  0.134
## Residuals   27   3868   143.3</code></pre>
<p>Means per group (that we calculated manually before), and coefficients of the treatment effect (unstandardised effect size), with standard error:</p>
<pre class="r"><code>model.tables(aov, &quot;mean&quot;, se=TRUE) #means</code></pre>
<pre><code>## Tables of means
## Grand mean
##          
## 77.53833 
## 
##  treatment 
## treatment
##     1     2     3 
## 80.25 71.13 81.23 
## 
## Standard errors for differences of means
##         treatment
##             5.353
## replic.        10</code></pre>
<pre class="r"><code>model.tables(aov, &quot;effects&quot;, se=TRUE) #coefficients</code></pre>
<pre><code>## Tables of effects
## 
##  treatment 
## treatment
##      1      2      3 
##  2.713 -6.404  3.692 
## 
## Standard errors of effects
##         treatment
##             3.785
## replic.        10</code></pre>
<p>Let’s format the output a bit:</p>
<pre class="r"><code>library(broom)
tidy.summ&lt;-tidy(aov)
tidy.summ</code></pre>
<pre><code>## # A tibble: 2 x 6
##   term         df sumsq meansq statistic p.value
##   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 treatment     2  620.   310.      2.16   0.134
## 2 Residuals    27 3868.   143.     NA     NA</code></pre>
<div id="reporting" class="section level2">
<h2>Reporting</h2>
<p>The treatment effect did not give a statistically significant difference, with F(2,27) = 2.16, p-value = 0.13</p>
</div>
</div>
<div id="effect-size" class="section level1">
<h1>Effect Size</h1>
<p>After computing ANOVA, you may calculate the Effect Size, R-Squared, that tells you how much of the variance is due to the treatment effect:</p>
<pre class="r"><code>sum_squares_treatment &lt;- tidy.summ$sumsq[1]
sum_squares_residuals &lt;- tidy.summ$sumsq[2]

R_squared &lt;- sum_squares_treatment /
            (sum_squares_treatment + sum_squares_residuals)

R_squared</code></pre>
<pre><code>## [1] 0.1381502</code></pre>
<p>The effects size R-Squared is 0.14.</p>
</div>
<div id="factorial-anova" class="section level1">
<h1>Factorial Anova</h1>
<p>In a factorial analysis of variance there are two groups (in the below example, type A and B), and a measure that has been acquired in a between subject design. In this case, each subject in each group underwent a different test (y or z).</p>
<p>Therefore, in our anova, we are going to consider the main effect of group, the main effect of test and the interaction between the two.</p>
<pre class="r"><code>subj1&lt;-rep(1:30)
group1&lt;-rep(&quot;a&quot;, 30)
condition&lt;-rep(c(&quot;y&quot;, &quot;z&quot;), 15)
response1&lt;-round(rnorm(30, mean = 15, sd = 0.5), digits = 2)

subj2&lt;-rep(31:60)
group2&lt;-rep(&quot;b&quot;, 30)
response2&lt;-round(rnorm(30, mean = 18, sd = 0.7), digits = 2)

fa_1&lt;-cbind(subj1, group1, condition, response1)
fa_2&lt;-cbind(subj2, group2, condition, response2)
fa&lt;-rbind(fa_1, fa_2)
fa.df&lt;-as.data.frame(fa)
colnames(fa.df)&lt;-c(&quot;subj&quot;, &quot;group&quot;, &quot;test&quot;, &quot;response&quot;)
fa.df$response&lt;-as.character(fa.df$response)
fa.df$response&lt;-as.numeric(fa.df$response)
str(fa.df)</code></pre>
<pre><code>## &#39;data.frame&#39;:    60 obs. of  4 variables:
##  $ subj    : Factor w/ 60 levels &quot;1&quot;,&quot;10&quot;,&quot;11&quot;,..: 1 12 23 34 45 56 58 59 60 2 ...
##  $ group   : Factor w/ 2 levels &quot;a&quot;,&quot;b&quot;: 1 1 1 1 1 1 1 1 1 1 ...
##  $ test    : Factor w/ 2 levels &quot;y&quot;,&quot;z&quot;: 1 2 1 2 1 2 1 2 1 2 ...
##  $ response: num  15.1 15 15.3 14.4 13.9 ...</code></pre>
<p>Output:</p>
<pre class="r"><code>av&lt;-aov(response ~ group*test, fa.df)
tidy.summ&lt;-tidy(av)</code></pre>
<p>And effects sizes:</p>
<pre class="r"><code>ssq&lt;-tidy.summ$sumsq
dof&lt;-tidy.summ$df
dof_res&lt;-tidy.summ$df[4]

ES1&lt;-(ssq[1]*dof[1])/(ssq[1]+dof[1]+dof_res)
ES2&lt;-(ssq[2]*dof[2])/(ssq[2]+dof[2]+dof_res)
ES3&lt;-(ssq[3]*dof[3])/(ssq[3]+dof[3]+dof_res)

cat(&quot;ES of group:&quot;, ifelse(ES1&lt;0.001, &quot;&lt; 0.001&quot;, round(ES1, 2)), &quot;\n&quot;)</code></pre>
<pre><code>## ES of group: 0.69</code></pre>
<pre class="r"><code>cat(&quot;ES of test:&quot;, ifelse(ES2&lt;0.009, &quot;&lt; 0.001&quot;, round(ES2, 2)), &quot;\n&quot;)</code></pre>
<pre><code>## ES of test: &lt; 0.001</code></pre>
<pre class="r"><code>cat(&quot;ES of interaction:&quot;, ifelse(ES3&lt;0.009, &quot;&lt; 0.001&quot;, round(ES3, 2)), &quot;\n&quot;)</code></pre>
<pre><code>## ES of interaction: &lt; 0.001</code></pre>
</div>
<div id="repeated-measures-anova" class="section level1">
<h1>Repeated measures ANOVA</h1>
<p>One of the assumptions of ANOVA is that the groups of which we are examining the means are independent. In other words, they do not have to be correlated, as it happens when you measure the same things on the same group of individuals. Broadly speaking, the errors will be smaller because measurements come from the same people, and this could significantly misallign your result. Look at our residual in the previous ANOVA: it’s approximately 24 but it might be bigger if we didn’t account for the correlation! The approach of ANOVA to this problem is to separate the calculations depending on different “strata”, and run a separate linear regression for each of them. In the formula, we need to specify the strata, for example, 1 for each subject. Note: while this is similar to a mixed model, it is <em>NOT a mixed model</em>. A mixed model does not run a separate least-square regression for each strata, but rather allow a different estimate of each coefficient within a pre-defined nesting.</p>
<p>In this example, each participant of group A and B made the two measurements of tests y and z. So we have two scores for each subject (within-subject design).</p>
<pre class="r"><code>subjr&lt;-rep(1:30,2)
subjr&lt;-sort(subjr)
groupr&lt;-rep(c(&quot;a&quot;, &quot;a&quot;, &quot;b&quot;, &quot;b&quot;), 15)
testr&lt;-rep(c(&quot;y&quot;, &quot;z&quot;), 15)
responser&lt;-sample(round(rnorm(500, mean=8, sd=6), digits=3), 60)
rd.df&lt;-as.data.frame(cbind(subjr, groupr, testr, responser))
rd.df$responser&lt;-as.numeric(as.character(rd.df$responser))
summary(rd.df)</code></pre>
<pre><code>##      subjr    groupr testr    responser      
##  1      : 2   a:30   y:30   Min.   :-11.541  
##  10     : 2   b:30   z:30   1st Qu.:  2.924  
##  11     : 2                 Median :  6.958  
##  12     : 2                 Mean   :  6.632  
##  13     : 2                 3rd Qu.: 10.215  
##  14     : 2                 Max.   : 23.339  
##  (Other):48</code></pre>
<pre class="r"><code>r.av&lt;-aov(responser ~ groupr*testr + Error(subjr), data = rd.df)
summ.tidy.rr&lt;-tidy(r.av)
summ.tidy.rr.eff&lt;-subset(summ.tidy.rr, term!=&quot;Residuals&quot;)
summ.tidy.rr.res&lt;-subset(summ.tidy.rr, term==&quot;Residuals&quot;, select = -c(statistic, p.value))</code></pre>
<p>Here are the statistics of the effects. We have three estimates, just as before, 2 for the effects of group and test, and their reciprocal interaction. The “stratum” indicates the grouping - in this case overall and repeated within subject. First, the between-subject factor is listed (group), and then the within-subject factors (test and its interaction):</p>
<pre class="r"><code>summ.tidy.rr.eff</code></pre>
<pre><code>## # A tibble: 3 x 7
##   stratum term            df sumsq meansq statistic p.value
##   &lt;chr&gt;   &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;
## 1 subjr   groupr           1  2.08   2.08    0.0863   0.771
## 2 Within  testr            1 85.9   85.9     1.63     0.212
## 3 Within  groupr:testr     1 87.4   87.4     1.66     0.208</code></pre>
<p>In fact, we have two residual errors this time, the between and the within subject errors:</p>
<pre class="r"><code>summ.tidy.rr.res</code></pre>
<pre><code>## # A tibble: 2 x 5
##   stratum term         df sumsq meansq
##   &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;
## 1 subjr   Residuals    28  676.   24.1
## 2 Within  Residuals    28 1472.   52.6</code></pre>
<p>We can calculate the percentage of variance explained by group, excluding the within-subject variation (partial ETA-Squared):</p>
<pre class="r"><code>p.eta.group&lt;-summ.tidy.rr.eff$sumsq[1]/(summ.tidy.rr.eff$sumsq[1]+summ.tidy.rr.res$sumsq[1])
cat(&quot;Partial Eta-Squared (group):&quot;, round(p.eta.group, 2))</code></pre>
<pre><code>## Partial Eta-Squared (group): 0</code></pre>
<p>The total eta-squared uses the total sum of squares, including both between and within subject errors:</p>
<pre class="r"><code>eta.group&lt;-summ.tidy.rr.eff$sumsq[1]/(summ.tidy.rr.eff$sumsq[1]+summ.tidy.rr.res$sumsq[1]+summ.tidy.rr.res$sumsq[2])
cat(&quot;Eta-Squared (group):&quot;, round(eta.group, 2))</code></pre>
<pre><code>## Eta-Squared (group): 0</code></pre>
<p>In summary, the approach of repeated-measures anova to repeated measures is <em>separation</em>, ie, fitting strata-level regressions per each unit of repetition. This works well when the groups are balanced, ie, each subject has equal number of observations and, hence, degrees of freedom, on which the calculation of the sum of squares is based. But if a subject misses one observations, it needs to be dropped or imputed. When the groups are unbalanced and we don’t want to drop subjects or impute observations, we need to take another approach. One is to use a linear model adding a correlation term between observations, “relaxing” the assumption of independence (Marginal Model or GEE). Another approach is to introduce another kind of effect, the random effect, typical of the mixed model, that allow to extract individual-level estimates.</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
